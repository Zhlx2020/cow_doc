# 介绍什么是网站的稳定性
## 什么是稳定性
对于大型微服务系统,面对任何的未知性因素,都能稳定的运行
## 为什么会不稳定
软件的整个生命周期,人为的因素一般有以下这些因素
::: details 人为因素
- 编码环节:代码逻辑问题,异常处理不合理,第三方库使用问题,没有遵守开发规范
- 运维环节:配置错误,限流阈值设置不合理,超时设置不合理
- 架构设计环节:没有做好限流,降级,熔断,无法应对流量突增,微服务之间的循环调用(走网关)
- 存储建设环节:数据库慢查询与索引没做好优化,死锁问题,连接池溢出,缓存命中率不高
- 资源不足:CPU,内存,磁盘,线程耗尽
:::

::: details 自然因素
- 网络故障:网络硬件故障
- 服务器故障:宕机,火灾,地震
- 三方服务问题:熔断
- 机房故障:火灾,地震
:::


## 稳定性的衡量标准SLA
**标准1**:性能,站点的响应速度与打开速度  
**标准2**:可用性,网站的正常运行时间与总时间的比率
| 级别 | 停机时间 | 描述|
| :--- | :--- | :--- |
| 99 | 87.6h | 基本可用 |
| 99.9 | 8.8h | 较高可用 |
| 99.99 | 53min | 技术容灾能力可用 |
| 99.999 | 5min | 极高可用 |

## 稳定性如何建设


### 第一要素:人  

::: details 确定参与稳定建设的人
- 老板带头   
- 落地需要开发,测试,运维,安全,产品都参与   
- 主导方是:开发,测试,运维   
每个团队都要背负一部分OKR指标,为什么必须要老板参与?因为涉及到绩效考核相关   
:::

::: details 降低人的犯错率
- 开发规范
- 测试规范
- 提测规范
- 上线规范
- 复盘规范
:::

::: details 如何确保遵守
- 奖惩机制   
- 日常考试   
:::

::: details 如何定责
- 第三方团队定责,避免扯皮
:::

::: details 规范补充
- 编码规范：
- 公共库使用规范：
- 项目结构规范：
- 数据库规范：
:::
### 第二要素:工具

::: details 常见的工具与平台
- 日志采集分析检索平台:不需要人肉分析日志
- 监控告警平台:不需要专人盯着监控
- 分布式追踪平台:整个链路可视化,定位问题有效率
- 自动化打包平台:CICD平台,避免人工出错
- 服务降级系统:故障自动控制恢复,无需人工处理(限流，熔断，降级)
- 预案平台:预定义故障方案（P0：致命，P1：严重，P2：重大....）
- 根因定位平台:记录系统中关键变更事件,当问题发生,根据历史查看和复盘.确定根本的原因,提供有效的故障排查
- 放火平台:模拟故障的平台,类似于混沌测试中的故障注入.可以提前预置问题,预防漏洞的可能性
:::


::: details 什么是混沌测试?
混沌测试就是在生产环境中随即引入故障和异常，来验证系统的弹性和稳定性，目的是在面对不可预期的事件时，系统仍然正常运行。   
特点：
1. 注入故障：随机的引入故障，比如部分系统崩溃，网络延迟，服务器不可用等。
2. 生产环境：通常在生产环境中进行，以真实的测试系统的应对能力。
3. 目标：发现潜在弱点，提高系统的弹性和稳定性。
:::

::: details 监控工具补充
- 流量监控：PV，UV，IP，热门页面，用户响应时间
- 流量毛刺：某一时间突然达到峰值，然后下降（观察不规律的流量毛刺）
- 业务监控：用户下单，退款，库存，销售额，在线，促销等等
- 机器监控：cpu，内存，磁盘IO，网络
- 日志记录：ELK，EFK
  
:::

::: details 测试补充
- 回归测试：软件修改，更新后验证先前的正常工作的功能是否仍然正常
- 冒烟测试：大规模更新之前，验证软件基本功能是否实现
:::

### 第三要素:预案

::: details 紧急预案
- 故障发生时通知那些人（上下游相关人员）
- 处理故障的协调者是谁
- 协调者职责：统筹全局，相关人员拉群，避免重复工作，保持和客服人员的沟通
- 操作关键开关时，谁有权力决策
- 常见故障应对止损方式
- 止损原则是什么，善后方案谁来拍板
:::


### 第四要素:目标

::: details 什么是OKR?
- Object:目标
- Key Results:关键成果(达到目标要做到哪些事情,需要有量化目标 提高30%)
:::


 
**如何合理的设定OKR?**  
首先要确定整个公司的大目标，比如：全年可用性为 99.99%。不能凭空乱设定,必须要先调研公司内部的bug,事故等相关平台,进行分析,将问题系统的归类。

::: details 调研结果
- 软件bug引起的系统不可用时间,100min
- 平台部署问题,集群架构问题导致不可用时间50min
- 安全问题导致不可用时间,40min
- 产品需求不合理,10min
:::

::: details 划分比例
- 研发占比:100/200=50%
- 运维占比:50/200=25%
- 安全与产品:50/200=25%

我们的整体高可用OKR假设为99.99 也就是 52min
那么按照比例分配后
- 研发占比:52min * 50% = 26min,研发团队必须将不可用时间缩减到26min
- 运维占比:52min * 25% = 11min
- 其他占比:52min * 25% = 11min
:::

设置好OKR之后,对目标的实现进行拆解,拆解的结果就是让每个团队都背负绩效指标 
::: details 团队OKR
开发团队:  
- 减少bug:季度bug减少20%
- 提高自动化测试覆盖率:覆盖90%以上单元测试,80%以上集成测试
- 减少部署失败次数:季度减少10%部署失败次数

测试团队:


运维团队:
:::



## 稳定性建设的四个方向



## 总结

```js
console.log('Hello, VitePress!');
```

::: details 扩展阅读
This is a details block.

:::



---
::: tip 🏁 本节结束
如有疑问请在评论区留言，或者找我的小牛吐槽。🐄
:::
