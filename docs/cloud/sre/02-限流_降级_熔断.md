# 限流、降级、熔断
## 微服务雪崩

**01 什么是微服务雪崩？** 
<p>微服务系统中，完成一个请求可能需要多个微服务共同完成。 </p> 
<p>我们可以把一个调用链上的两个上下游微服务分为：<mark>调用方</mark> 和 <mark>服务器提供方</mark></p> 
<p>如果 <u>服务提供方</u> 发生了故障或者网络异常，都可能导致 <u>调用方</u> 被阻塞等待。</p>
<p>如果 <u>调用方</u> 的超时时间设置的很长，资源可能被耗尽。这又会导致上游的资源被耗尽，最后在高并发场景下引起  <u>雪崩问题</u> 。</p> 

**02 为什么会导致资源耗尽？**   
<p>下游服务不响应上游，上游阻塞，此时依旧有大量的请求从上游发到下游，这个时候所有的请求都阻塞，没有办法继续处理。此时线程池内的线程越来越少，最后导致资源耗尽。</p>
<p>当前服务器的资源被耗尽，调用当前服务器的上游也会发生同样的情况。最后导致整个调用链雪崩。</p>

**03 如何抵御雪崩？**  
<p>针对于上游的服务，采取限流。针对下游服务，采取熔断。针对当前服务，采取降级。</p>

## 什么是限流？
<p> 限流是从系统的流量入口考虑，当前的系统处理能力无法应对外部突增的流量时，为了不让系统崩溃，从进入的流量进行限制，只允许系统能够承受的流量进入，不能承受的直接丢弃。</p>

**限流方案1 令牌桶**   
<p>令牌桶算法的原理：系统会以一个恒定的速度往一个桶里面放置令牌，如果请求要被处理，去桶里领取一个令牌。当桶里没有令牌的时候，直接拒绝服务</p>
<p>优点：流量放行均匀，有效应对突发流量</p>
<p>缺点：实际限流数难以预知</p>

**限流方案2 漏桶算法**   
**限流方案3 滑动时间窗口**   
**限流方案4 滑动时间窗口**   

## 什么是熔断？
<p>在上游服务和下游服务之间加一层熔断器，上游调用下游必须经过 <u>熔断器</u>。</p>
<p>当上游服务在调用下游服务的时候，可能下游服务故障，或遇到网络波动响应慢，也可能是服务收到的请求处理不过来负载过高了。这个时候上游多次调用下游没有反应，熔断器就会直接将熔断器到下游的链路直接切断，上游再次发起请求时，熔断器直接返回失败，请求流量不会到达下游，这个时候就保证了下游不会被进一步的流量冲垮。</p>

## 什么是降级？
<p>当前服务器压力突增时，为了保证核心的功能可用，选择降低一些不关键的服务的功能，或者直接关闭该功能。</p>
<p>等到高峰期结束之后，或者问题解决之后，再将这些服务打开。</p>


